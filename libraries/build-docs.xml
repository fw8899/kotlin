<project name="Kotlin standard library" default="document">
    <!-- Generates the standard library documentation using Dokka. -->
    <property name="github.revision" value="master"/>
    <property name="dokka.path" value="../dependencies/dokka" />
    <property name="js.stdlib.src.path" value="../dependencies/js-stdlib-src" />
    <property name="output" value="${basedir}/doc" />

    <typedef resource="dokka-antlib.xml">
        <classpath>
            <fileset dir="${dokka.path}/lib">
                <include name="*.jar"/>
            </fileset>

            <!-- used for running locally -->
            <pathelement path="${dokka.path}/out/artifacts/dokka.jar"/>
        </classpath>
    </typedef>

    <target name="clean">
        <delete dir="${output}"/>
        <mkdir dir="${output}"/>
    </target>

    <target name="document" depends="clean">
        <dokka samples="stdlib/samples/src" outputDir="${output}/jre8" moduleName="kotlin-stdlib" skipDeprecated="true" outputFormat="kotlin-website" jdkversion="8" impliedplatforms="JVM,JS"
               include="stdlib/src/Module.md">

            <sourceRoot path="stdlib/src" platforms="JVM"/>
            <sourceRoot path="stdlib/jre7/src" platforms="JVM,JRE7"/>
            <sourceRoot path="stdlib/jre8/src" platforms="JVM,JRE8"/>
            <sourceRoot path="../core/builtins" platforms="JVM"/>
            <sourceRoot path="../core/reflection.jvm" platforms="JVM"/>
            <sourceRoot path="../core/runtime.jvm/src/kotlin/jvm/annotations" platforms="JVM"/>
            <sourceRoot path="../core/runtime.jvm/src/kotlin/jvm/JvmClassMapping.kt" platforms="JVM"/>
            <sourceRoot path="../core/runtime.jvm/src/kotlin/jvm/PurelyImplements.kt" platforms="JVM"/>

            <sourceRoot path="../core/builtins" platforms="JS"/>
            <sourceRoot path="${js.stdlib.src.path}" platforms="JS"/>

            <sourcelink path=".." url="http://github.com/JetBrains/kotlin/blob/${github.revision}" linesuffix="#L"/>
        </dokka>
        <dokka src="kotlin.test/shared/src/main/kotlin:kotlin.test/shared/src/main/kotlin.jvm:kotlin.test/junit/src/main"
               outputDir="${output}/jre8" moduleName="kotlin-test" skipDeprecated="true" outputFormat="kotlin-website" jdkversion="8">
            <sourcelink path=".." url="http://github.com/JetBrains/kotlin/blob/${github.revision}" linesuffix="#L"/>
        </dokka>
    </target>

    <target name="zip" depends="document">
        <zip destfile="target/stdlib-docs.zip" basedir="${output}/jre8/kotlin-stdlib"/>
    </target>
</project>
